<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sudoku Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6366f1">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --bg-color: #f8fafc;
            --board-bg: #ffffff;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --border-light: #e2e8f0;
            --border-dark: #1e293b;
            --selected-cell: #c7d2fe;
            --highlight-cell: #f1f5f9;
            --error-text: #ef4444;
            --fixed-text: #0f172a;
            --user-text: #4f46e5;
            --modal-bg: rgba(15, 23, 42, 0.6);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            max-width: 500px;
            margin: 0 auto;
            user-select: none;
            touch-action: manipulation;
            overflow: hidden; /* Prevent bouncing on mobile */
        }

        /* Header Area - More Compact */
        .header-section {
            width: 100%;
            padding: 10px 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .top-row { display: flex; justify-content: space-between; align-items: center; }
        .top-row h1 { font-size: 1.2rem; font-weight: 800; color: var(--primary-dark); letter-spacing: -0.5px; }
        
        .controls { display: flex; gap: 5px; }
        button, select {
            padding: 6px 10px;
            border-radius: 8px;
            border: 1px solid var(--border-light);
            background: white;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-main);
        }
        .btn-primary { background: var(--primary); color: white; border: none; }

        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: white;
            padding: 8px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
            font-size: 0.85rem;
            font-weight: 600;
        }

        /* Sudoku Grid */
        .game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            width: 100%;
            padding: 10px;
        }

        .board-container {
            width: 100%;
            aspect-ratio: 1 / 1;
            background: var(--border-dark);
            padding: 2px;
            border-radius: 6px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .board {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            grid-template-rows: repeat(9, 1fr);
            width: 100%;
            height: 100%;
            background: var(--board-bg);
            gap: 1px;
        }
        .cell {
            background: var(--board-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--user-text);
        }
        
        /* High-Contrast Borders */
        .cell:nth-child(3n) { border-right: 2px solid var(--border-dark); }
        .cell:nth-child(9n) { border-right: none; }
        .cell:nth-child(n+19):nth-child(-n+27),
        .cell:nth-child(n+46):nth-child(-n+54) { border-bottom: 2px solid var(--border-dark); }

        .cell.fixed { color: var(--fixed-text); font-weight: 800; background: #fcfcfc; }
        .cell.selected { background-color: var(--selected-cell) !important; }
        .cell.highlight { background-color: var(--highlight-cell); }
        .cell.error-stay { color: var(--error-text); }
        .cell.error-anim { animation: shake 0.2s ease-in-out; color: var(--error-text); }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        /* Split Number Pad - Side Aligned */
        .numpad-container {
            width: 100%;
            padding: 10px 15px 30px;
            display: flex;
            justify-content: space-between;
            gap: 15px;
        }
        .num-side {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            flex: 1;
        }
        .num-btn {
            background: white;
            border: 1px solid var(--border-light);
            border-radius: 12px;
            font-size: 1.4rem;
            font-weight: 700;
            padding: 12px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: 0.1s;
        }
        .num-btn:active { background: #f1f5f9; transform: scale(0.95); }
        .erase { color: var(--error-text); font-size: 0.9rem; }

        /* Modals */
        .modal-overlay {
            position: fixed; inset: 0; background: var(--modal-bg);
            display: none; justify-content: center; align-items: center;
            z-index: 100; backdrop-filter: blur(4px);
        }
        .modal {
            background: white; padding: 20px; border-radius: 20px;
            width: 85%; max-width: 320px; text-align: center;
        }
        .modal h2 { margin-bottom: 15px; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-item { background: var(--bg-color); padding: 8px; border-radius: 10px; font-size: 0.8rem; }
        .stat-item b { display: block; font-size: 1.1rem; color: var(--primary); }
        .history-list { max-height: 150px; overflow-y: auto; margin-bottom: 10px; }
        .h-item { font-size: 0.75rem; padding: 5px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; }
    </style>
</head>
<body>

    <div class="header-section">
        <div class="top-row">
            <h1>SUDOKU</h1>
            <div class="controls">
                <select id="difficulty" onchange="startNewGame()">
                    <option value="easy">Easy</option>
                    <option value="medium" selected>Med</option>
                    <option value="hard">Hard</option>
                </select>
                <button onclick="showHistory()">Records</button>
                <button class="btn-primary" onclick="startNewGame()">New</button>
            </div>
        </div>
        <div class="stats-bar">
            <span>‚è± <b id="timer">00:00</b></span>
            <span style="color: var(--error-text)">‚ùå <b id="mistakes">0</b></span>
            <span>üî¢ <b id="moves">0</b></span>
        </div>
    </div>

    <div class="game-area">
        <div class="board-container">
            <div class="board" id="board"></div>
        </div>
    <div class="numpad-container">
        <div class="num-side">
            <div class="num-btn" onclick="inputNumber(1)">1</div>
            <div class="num-btn" onclick="inputNumber(2)">2</div>
            <div class="num-btn" onclick="inputNumber(3)">3</div>
            <div class="num-btn" onclick="inputNumber(4)">4</div>
            <div class="num-btn" onclick="inputNumber(5)" style="grid-column: span 2;">5</div>
        </div>
        <div class="num-side">
            <div class="num-btn" onclick="inputNumber(6)">6</div>
            <div class="num-btn" onclick="inputNumber(7)">7</div>
            <div class="num-btn" onclick="inputNumber(8)">8</div>
            <div class="num-btn" onclick="inputNumber(9)">9</div>
            <div class="num-btn erase" onclick="inputNumber(0)" style="grid-column: span 2;">ERASE</div>
        </div>
    </div>
    </div>



    <div class="modal-overlay" id="winModal">
        <div class="modal">
            <h2>üèÜ Solved!</h2>
            <div class="stat-grid">
                <div class="stat-item">Time<b id="winTime"></b></div>
                <div class="stat-item">Mistakes<b id="winMistakes"></b></div>
                <div class="stat-item">Moves<b id="winMoves"></b></div>
                <div class="stat-item">Level<b id="winLevel"></b></div>
            </div>
            <button class="btn-primary" style="width:100%; padding:12px;" onclick="location.reload()">New Game</button>
        </div>
    </div>

    <div class="modal-overlay" id="historyModal">
        <div class="modal">
            <h3>Recent Records</h3><br>
            <div class="history-list" id="historyList"></div>
            <button onclick="closeModal('historyModal')" style="width:100%; margin-top:10px;">Close</button>
        </div>
    </div>

    <script>
        
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playTone(freq, type, duration, vol=0.05) {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + duration);
        }
        
        const Sounds = {
            tap: () => playTone(600, 'sine', 0.1),
            err: () => playTone(150, 'sawtooth', 0.2, 0.1),
            win: () => { [440, 554, 659, 880].forEach((f, i) => setTimeout(() => playTone(f, 'sine', 0.4), i*150)); }
        };

        let solution = [], currentBoard = [], initialBoard = [];
        let selectedRow = -1, selectedCol = -1;
        let time = 0, mistakes = 0, moves = 0, timer;

        function init() {
            const boardEl = document.getElementById('board');
            for (let r = 0; r < 9; r++) {
                for (let c = 0; c < 9; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.id = `cell-${r}-${c}`;
                    cell.onclick = () => {
                        selectedRow = r; selectedCol = c;
                        if(initialBoard[r][c] === 0) Sounds.tap();
                        renderBoard();
                    };
                    boardEl.appendChild(cell);
                }
            }
            startNewGame();
        }

        function startNewGame() {
            clearInterval(timer);
            time = 0; mistakes = 0; moves = 0;
            updateStats();
            timer = setInterval(() => { time++; updateStats(); }, 1000);
            
            solution = Array(9).fill().map(() => Array(9).fill(0));
            fill(solution);
            
            const d = document.getElementById('difficulty').value;
            let h = d === 'easy' ? 30 : (d === 'medium' ? 45 : 55);
            currentBoard = solution.map(r => [...r]);
            while(h > 0) {
                let r = Math.floor(Math.random()*9), c = Math.floor(Math.random()*9);
                if(currentBoard[r][c] !== 0) { currentBoard[r][c] = 0; h--; }
            }
            initialBoard = currentBoard.map(r => [...r]);
            renderBoard();
        }

        function fill(b) {
            for(let r=0; r<9; r++) for(let c=0; c<9; c++) if(b[r][c] === 0) {
                let ns = [1,2,3,4,5,6,7,8,9].sort(()=>Math.random()-0.5);
                for(let n of ns) if(isValid(b,r,c,n)) {
                    b[r][c] = n; if(fill(b)) return true; b[r][c] = 0;
                } return false;
            } return true;
        }

        function isValid(b,r,c,n) {
            for(let i=0; i<9; i++) if(b[r][i]===n || b[i][c]===n) return false;
            let br=Math.floor(r/3)*3, bc=Math.floor(c/3)*3;
            for(let i=0; i<3; i++) for(let j=0; j<3; j++) if(b[br+i][bc+j]===n) return false;
            return true;
        }

        function renderBoard() {
            for(let r=0; r<9; r++) for(let c=0; c<9; c++) {
                const el = document.getElementById(`cell-${r}-${c}`);
                const val = currentBoard[r][c];
                el.innerText = val || '';
                el.className = 'cell' + (initialBoard[r][c] ? ' fixed' : '');
                if(val && val !== solution[r][c]) el.classList.add('error-stay');
                if(r === selectedRow && c === selectedCol) el.classList.add('selected');
                else if(r===selectedRow || c===selectedCol) el.classList.add('highlight');
            }
        }

        function inputNumber(n) {
            if(selectedRow < 0 || initialBoard[selectedRow][selectedCol] !== 0) return;
            moves++;
            currentBoard[selectedRow][selectedCol] = n;
            if(n !== 0 && n !== solution[selectedRow][selectedCol]) {
                mistakes++; Sounds.err();
                document.getElementById(`cell-${selectedRow}-${selectedCol}`).classList.add('error-anim');
            } else if(n !== 0) { Sounds.tap(); }
            updateStats(); renderBoard(); checkWin();
        }

        function updateStats() {
            const m = Math.floor(time/60).toString().padStart(2,'0');
            const s = (time%60).toString().padStart(2,'0');
            document.getElementById('timer').innerText = `${m}:${s}`;
            document.getElementById('mistakes').innerText = mistakes;
            document.getElementById('moves').innerText = moves;
        }

        function checkWin() {
            if(JSON.stringify(currentBoard) === JSON.stringify(solution)) {
                clearInterval(timer); Sounds.win();
                save();
                document.getElementById('winTime').innerText = document.getElementById('timer').innerText;
                document.getElementById('winMistakes').innerText = mistakes;
                document.getElementById('winMoves').innerText = moves;
                document.getElementById('winLevel').innerText = document.getElementById('difficulty').value;
                document.getElementById('winModal').style.display = 'flex';
            }
        }

        function save() {
            let rs = JSON.parse(localStorage.getItem('sudoku-pro') || '[]');
            rs.unshift({ d: new Date().toLocaleDateString(), t: document.getElementById('timer').innerText, l: document.getElementById('difficulty').value });
            localStorage.setItem('sudoku-pro', JSON.stringify(rs.slice(0,10)));
        }

        function showHistory() {
            const rs = JSON.parse(localStorage.getItem('sudoku-pro') || '[]');
            document.getElementById('historyList').innerHTML = rs.map(r => `<div class="h-item"><span><b>${r.l}</b> ${r.d}</span> <span>‚è± ${r.t}</span></div>`).join('') || 'No records yet';
            document.getElementById('historyModal').style.display = 'flex';
        }

        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        window.onload = init;

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
</body>
</html>
